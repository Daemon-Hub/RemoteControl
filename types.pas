unit types;

interface

uses System.Collections.Generic, Newtonsoft.Json;

const
  /// Предоставляет символ, задаваемый платформой, для разделения уровней папок в строке пути
  SLASH = System.IO.Path.DirectorySeparatorChar;
  
  MAX_RETRIES = 5;    // Количество попыток подключения к серверу
  RETRY_DELAY = 2000; // Задержка между поптыками подключения (мс)
  
  GETPATH = '%GETPATH%';
  GET_WIN_INFO = '%WININFO%';
  
  //  DEFAULT COMMANDS  //
  E_GET_PATH = 'E@01';
  E_GET_DIRS = 'E@02';
  E_GET_FILES = 'E@03';
  E_ARROW_UP = 'E@04';
  E_ENTER_FOLDER = 'E@05';
  E_ENTER_SHORTCUT = 'E@06';
  
  //  WORKING WITH EXPLORER ITEMS  //
  E_RECEIVE_FILE = 'E@10';
  E_FILE_SUCCESSFULLY_TRANSFERRED = 'E@11';
  E_CUT_ITEM = 'E@12';
  E_COPY_ITEM = 'E@13';
  E_PASTE_ITEM = 'E@14';
  E_DELETE_ITEM = 'E@15';
  E_GET_ALL_FILES_IN_FOLDER = 'E@16';
  E_RENAME = 'E@17';
  
  //  ERROR CODES  //
  E_ERROR_OPEN_FILE = 'R@20';
  E_ERROR_OPEN_FOLDER = 'R@21';
  E_ERROR_RENAME = 'R@22';

/// Инициализирует массив с необходимыми картинками для правильной работы окна с подключёнными устройствами
procedure InitWinIcons();

/// Преобразует строку в кодировке base64 в картинку и возвращает объект System.Drawing.Image
function ImageFromBase64(base64: string): System.Drawing.Image;

/// Удаляет вначале и в конце строки str все chars или пробелы по умолчанию
function Strip(str: string; chars: string := ' '): string;


type
  /// Представляет состояние выполнения сервисов
  ServiceState = (Run, Stop, Resume);
  
  /// Необходимая информация для коректной работы проводника
  ExplorerInformation = record
    public Drives: array of System.IO.DriveInfo;
    public Desktop, Downloads, Music, Documents, Pictures, User: string;
    constructor(dr: array of System.IO.DriveInfo; params commons: array of string);
    begin
      self.Drives := dr;
      (Desktop, Documents, Music, Pictures, User) := commons;
      Downloads := $'{User}{SLASH}Downloads';
    end;
    
    function GetSpecialFolders() := [Desktop, Downloads, Music, Pictures, Documents, User];
    function GetItem(key: string): string;
    begin
      case key of
        'Рабочий стол': Result := self.Desktop;
        'Загрузки': Result := self.Downloads;
        'Документы': Result := self.Documents;
        'Изображения': Result := self.Pictures;
        'Музыка': Result := self.Music;
      else Result := self.User;
      end;      
    end;
    
    function DrivesNames(): set of string;
    begin
      var res: set of string;
      foreach var drive in self.Drives do 
        res += (drive.Name);
      Result := res;
    end;
  end;
  
  /// Представляет структуру для хранения информации про систему клиентов
  WindowsInformation = record
    public OS, Platform, UserName, ComputerName: string;
    public ExInfo: ExplorerInformation;
    constructor(ex: ExplorerInformation; params info: array of object);
    begin
      self.ExInfo       := ex;
      self.OS           := info[0] as string;
      self.Platform     := info[1] as string;
      self.UserName     := info[2] as string;
      self.ComputerName := info[3] as string;
    end;
  end;
  
  /// Хранит в себе путь к файлу/папке (TakeFrom), который был вырезан/скопирован (Code) и куда ее надо вставить (PasteHere)
  PasteInformation = record
    public Code, SourcePath, DestinationPath, Items: string;
    constructor();begin end;
    /// Откуда копировать
    function TakeFrom(item: string): string := $'{self.SourcePath}{SLASH}{item}';
    /// Куда вставлять
    function PasteHere(item: string): string := $'{self.DestinationPath}{SLASH}{item}';
  end;


var
  /// 
  WinIcons: Dictionary<string, System.Drawing.Image>;


implementation

function ImageFromBase64(base64: string): System.Drawing.Image;
begin
  var bytes := Convert.FromBase64String(base64);
  var ms := new System.IO.MemoryStream(bytes);
  Result := System.Drawing.Image.FromStream(ms);
end;


procedure InitWinIcons();
begin
  WinIcons := new Dictionary<string, System.Drawing.Image>;
  WinIcons.Add('7', ImageFromBase64('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'));
  WinIcons.Add('8', ImageFromBase64('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'));
  WinIcons.Add('10', ImageFromBase64('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'));
  WinIcons.Add('11', ImageFromBase64('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'));
  WinIcons.Add('computer', ImageFromBase64('iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVR4nO2czWoTYRiFgwsV0QuQulRvQXQpE3TnwlpIDG46pZeRtSD5ATfFQLSZLpo6k1HBzatTkaQ3IXwXIC2o2y5Gpi6UaBfNDJ5M8jxwtjN5z3l/QhapVAAAAAAAAAAAAP7g/mP/mldb3/Nq/o9q3U+Rf6oHJx7V/NCrbd4ozvy6f4Tp/pkaL/Ps7pPNldwBZJ2P+f6MU7++W0AArJ3q7AF8yx3A9EPNHSN3ugfTfhGA+78NQwBOO6EE4AhgqW9ElRtwTADqLjQmQG+EsYL0ZphA3ABHAPIuNCZAb4SxgvRmmEDcAEcA8i40JkBvhLGC9GaYQNwARwDyLjQmQG+EsYL0ZphA3ABHAPIuNCZAb4SxgvRmmEDcAEcA8i40JkBvhLGC9GaYQNwARwDyLjQmQG+EsYL0ZphA3ABHAPIuNCZAb4SxgvRmmEDcAEcA8i40JkBvhC3qCkL+mTwggLq2aQigTgBLvbYqeYmTSYomM3tAAIm2gRY2gGcvtlPvYSP1VhtpqxfIP8/SBeCtNtJb9x6cqPqosbgBjJLxd3URcWkDGOf/w6ZRMgn1hUz+UrZ2shAy81u9gfzz/Eujj+O93AFE9vlmnIwP1cXEpdP46M3+wfVKEbz7cLASJ5PdeV1H8Rwp8yjr/MLMV9Lv9y92gijNo273/QV1HaWlNQiv5g0ge4a6jtLS3R7dyRtAeye6ra6jtLSDaCN3AEG0oa6jtHSC6FXeALJnqOsoJc3h8Hx7EH3NPwHhIYd4BrqDaK2A7v/1TWgQrRXfIgvM1tbbS50g/FJUAO0gdM+Hw8vqukpBs9k8V9Dunw7hZfZsdX1zy9NefKW189prD8JPRZv/W+F+9o7sXep654ZY/NNBZdmJCYAAlpqYCQAAAAAAAAAAAACoLD4/AZVkZ5PvUg+EAAAAAElFTkSuQmCC'));
end;


function Strip(str, chars: string): string;
begin
  var from := 0;
  var to_ := 0;
  for var i := 1 to str.Length do
    if not (str[i] in chars) then
      if from = 0 then from := i else
        to_ := i;
  if (from = 0) and (to_ = 0) then exit('');
  if to_ < from then
    to_ := from;
  Result := Copy(str, from, to_ - from + 1);
end;


end.